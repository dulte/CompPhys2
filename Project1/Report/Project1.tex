\documentclass[a4paper, 10pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{verbatim}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{a4wide}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[dvips]{epsfig}
\usepackage[toc,page]{appendix}
\usepackage[T1]{fontenc}
\usepackage{cite} % [2,3,4] --> [2--4]
\usepackage{shadow}
\usepackage{hyperref}
\usepackage{titling}
\usepackage{marvosym }
\usepackage{physics}
\usepackage{subcaption}
\usepackage[noabbrev]{cleveref}
\usepackage{wasysym}


\renewcommand{\topfraction}{.85}
\renewcommand{\bottomfraction}{.7}
\renewcommand{\textfraction}{.15}
\renewcommand{\floatpagefraction}{.66}
\renewcommand{\dbltopfraction}{.66}
\renewcommand{\dblfloatpagefraction}{.66}
\setcounter{topnumber}{9}
\setcounter{bottomnumber}{9}
\setcounter{totalnumber}{20}
\setcounter{dbltopnumber}{9}


\setlength{\droptitle}{-10em}   % This is your set screw

\setcounter{tocdepth}{2}

\lstset{language=c++}
\lstset{alsolanguage=[90]Fortran}
\lstset{basicstyle=\small}
\lstset{backgroundcolor=\color{white}}
\lstset{frame=single}
\lstset{stringstyle=\ttfamily}
\lstset{keywordstyle=\color{red}\bfseries}
\lstset{commentstyle=\itshape\color{blue}}
\lstset{showspaces=false}
\lstset{showstringspaces=false}
\lstset{showtabs=false}
\lstset{breaklines}
\title{FYS4411 - Project 1\\
Variational Monte Carlo}
\author{Daniel Heinesen, Gunnar Lange \& Aram Salihi}
\begin{document}
\maketitle
\begin{abstract}
Abstract awesomeness
\end{abstract}
\tableofcontents
\section{Introduction}
\section{Theoretical model}
We investigate bosons in a potential trap. The Hamiltonian of such a system for $N$ bosons is in general given by:
\begin{equation} \label{eq:general_Hamiltonian}
H=\sum_{i=1}^N\left(-\frac{\hbar^2}{2m}\nabla_i^2 +V_{ext}(\boldsymbol{r}_i)\right)+\sum_{i<j}^N V_{int}(\boldsymbol{r}_i, \boldsymbol{r}_j)
\end{equation}
Where $V_{ext}$ is the external potential, i.e. the potential of the trap, whereas $V_{int}$ is the interal potential, i.e. the potential between the bosons. We wish to approximate the ground state energy of our system described by the Hamiltonian given in equation \ref{eq:general_Hamiltonian}.
\subsection{The potentials employed}
\subsubsection{The external potential}
We will focus on two different trap shapes: spherical and elliptical. The spherical trap can be described by a standard harmonic oscillator potential, which is given by:
\begin{equation}
V_{ext}(\boldsymbol{r})=\frac{1}{2}m\omega_{ho}^2 r^2 \quad \mathrm{(spherical\  trap)}
\end{equation}
Where $m$ is the mass of the bosons and $\omega_{ho}$ is a parameter characterizing the strength of the potential (the characteristic frequency of the trap). The elliptical trap, however, is given by:
\begin{equation}
V_{ext}(\boldsymbol{r})=\frac{1}{2}m[\omega_{ho}^2 (x^2+y^2)+\omega_z z^2] \quad \mathrm{(elliptical\  trap)}
\end{equation}
I.e. we allow the strength of the potential to vary in one direction, which we designate as the $z$-axis.
\subsubsection{The internal potential}
We will begin by investigating models where there is no repulsion between the bosons, however, we will later act a repulsive potential that prevents bosons from occupying the same point in space. With $a$ as a typical diameter of our bosons (the hard-core diameter), we define our internal potential as:
\begin{equation}
V_{int}(|\boldsymbol{r}_i-\boldsymbol{r}_j|)= 
     \begin{cases}
       \infty & \quad |\boldsymbol{r}_i-\boldsymbol{r}_j| \leq  a\\
       0 & \quad |\boldsymbol{r}_i-\boldsymbol{r}_j|>  a\\
     \end{cases}
\end{equation}
This potential thus represents the impossibility of bosons to occupy the same point in space.
\subsection{The variational method}
\subsubsection{The variational principle}
To find the ground state energy, $E_0$ of bosons trapped in a potential, we employ the variational method. The variational principle states that:
\begin{equation}
E_0\leq \langle \Psi_T |H|\Psi_T \rangle
\end{equation}
Where $H$ is the Hamiltonian of our system and $\Psi_T$ is any normalized trial wavefunction. We therefore choose a functional form for $\Psi_T$, with a number of free parameters. By varying these parameteres, we can find an upper bound for the ground state energy. If our chosen functional form is reasonably close to the exact wavefunction, $\Psi$ of the system, then our estimate for $E_0$ should be reasonably close to the actual ground state energy of our system.
\subsubsection{Choosing a trial wavefunction}










\section{Methods}\label{Method_section}
\subsection{Minimizing computation in the non-interacting case}
For the non-interacting case ($a=0$), certain shortcuts are possible, to save FLOPS. 
\subsubsection{Computing the numerical energy}
From the Schr√∂dinger equation:
\begin{equation}
\hat{H}\Psi_T = \left(-\frac{1}{2}\nabla^2+V\right)\Psi_T= E\Psi_T
\end{equation}
The kinetic energy is, numerically, given by (in dimensionless form):
\begin{equation}
T=-\frac{1}{2}\nabla^2 \Psi_T
\end{equation}
This gives, for particle $i$ and component $j$:
\begin{equation}
T_{ij} \approx \frac{\Psi_T(\boldsymbol{r_1},...,\boldsymbol{r_{i,j}}+h,...,\boldsymbol{r_n})-2\Psi_T(\boldsymbol{r})+\Psi_T(\boldsymbol{r_1},...,\boldsymbol{r_{i,j}}-h,...,\boldsymbol{r_n})}{h^2}
\end{equation}
Which gives, for the simplest trialfunction ($a=0$):
\small
\begin{equation}
T_{ij}=-\frac{1}{2}\Psi_T\left(\frac{\exp(-\alpha_j (x_j+h)^2)}{\exp(-\alpha_j x_j^2)}-2+\frac{\exp(-\alpha_j ( x_j -h)^2)}{\exp(-\alpha_j x_j^2)}\right)\frac{1}{h^2}=-\frac{1}{2h^2}\Psi_T\left(\exp(-2\alpha_j x_j h-\alpha_jh^2)+\exp(2\alpha_j x_j h-\alpha_j h^2)-2\right)
\end{equation}
\normalsize


\section{Results and discussion}
\section{Conclusion}
\subsection{Conclusion}

\subsection{Outlook}

\begin{appendices}
\section{Finding the drift force}
We wish to compute:
\begin{equation}
\vec{F}=2\frac{1}{\psi_T}\nabla \psi_T
\end{equation}
\section{Finding the analytic expression for the local energy}
We wish to find:
\begin{equation}
E_L=\frac{1}{\Psi_T}\nabla^2 \Psi_T
\end{equation}
Where $\Psi_T$ is given by:
\begin{equation}
\exp\left[ -\alpha \sum_{i}^n\left(x_i^2+y_i^2+z_i^2\right)\right]\prod_{i<j}f(a, |\mathbf{r}_i-\mathbf{r}_j|)
\end{equation}
Look first at $a=0$. In this case, this reduces to the harmonic oscillator potential. The local energy is then:
\begin{equation}
\exp\left[ \alpha \sum_{i}^n\left(x_i^2+y_i^2+z_i^2\right)\right]\left(-\frac{\hbar^2}{2m_i}\nabla_i^2+V\right)\exp\left[ -\alpha \sum_{i}^n\left(x_i^2+y_i^2+z_i^2\right)\right]
\end{equation}
In the simple harmonic oscillator case, this gives:
\begin{equation}
E_L(\mathbf{r},\alpha)=-\frac{\hbar^2}{2m}\sum_{i=1}^n 2\alpha \left(2\alpha(x_i^2+y_i^2+z_i^2)-3\right)+\frac{1}{2}m\omega_{ho}^2\sum_{i=1}^n(x_i^2+y_i^2+z_i^2)
\end{equation}
\textbf{FIX FOR ONE/N PARTICLES AND LOWER DIMENSION}
Similarly for the drift force:
\begin{equation}
F=\frac{2\nabla \Psi_T}{\Psi_T}
\end{equation}
\begin{equation}
F=-2\alpha\sum_{i=1}^n(x_i+y_i+z_i)
\end{equation}
Now for the ugly part:\\
For one particle, $\nabla_k$:
\begin{equation}
\nabla_k\Psi_{T} = \nabla_k\left(\Psi_T(\mathbf{r})=\nabla_k \prod_{i=1}^n\phi(\mathbf{r}_i)\exp\left(\sum_{i<j} u(r_{ij})\right)\right)
\end{equation}
Now apply the product rule. For the first term, all terms are unchanged except where $i=k$, giving the first term as:
\begin{equation}
\nabla_k \phi(\mathbf{r}_k)\left[ \prod_{i\neq k} \phi(\mathbf{r}_i)\right]\exp\left(\sum_{i<j}u(r_{ij})\right)
\end{equation}
The second term is trickier. We can rewrite it as follows:
\begin{align}
  \prod_{i}\phi(\bold{r}_{i})\nabla_{k}\left[\exp\left(\sum_{i < j}u(r_{ij})\right)\right]
  = \prod_{i}\phi(\bold{r}_{i})\nabla_{k}\left[\exp\left(\sum_{j = 1}^{n}\sum_{i = 1}^{j-1}u(r_{ij})\right)\right]
  \label{second term in first derivative}
\end{align}
This is calculated by using the chain-rule. To evaluate the innerfunction, we must look
at \\$1 \le j \le k$, $j = k$ and $j \ge k$. Begining with $1\le  j \le k$,
the first sum is from $1$ up the kth particle, meaning all terms differentiated before $k$ vanishes
and we are left with $u(r_{ik})$, thus leaving with us with:
\begin{align}
  \prod_{i}\phi(\bold{r}_{i})\nabla_{k}\left[\exp\left(\sum_{j = 1}^{k}\sum_{i = 1}^{k-1}u(r_{ij})\right)\right]
  =
  \prod_{i}\phi(\bold{r}_{i})\exp{\left(\sum_{i<j}u(r_{ij})\right)}
  \left[\sum_{i = 1}^{k-1}\nabla_{k}u(r_{ik})\right]
\end{align}
For $j = k$, we see that the first sum goes from and end up at kth particle, meaning
this sum vanishes, secondly, the second sum is evaluated at $1 \le i \le k-1$, leaving with
constants up to $k-1$, thus this term becomes $0$.
\begin{align}
\prod_{i}\phi(\bold{r}_{i})\nabla_{k}\left[\exp\left(\sum_{j = 1}^{n}\sum_{i = 1}^{j-1}u(r_{ij})\right)\right]
= 0
\end{align}
For $j > k$,the first sum goes from $k+1\le j \le n$ and the second $1 \le i \le k$.  The second sum vanishes, because all constants are differentiated away
except the last term $i = k$. This leaves us with:
\begin{align}
  \prod_{i}\phi(\bold{r}_{i})\nabla_{k}\left[\exp\left(\sum_{j = k+1}^{n}\sum_{i = 1}^{k}u(r_{ij})\right)\right]
  = \prod_{i}\phi(\bold{r}_{i})
  \exp{\left(\sum_{i<j}u(r_{ij})\right)}
  \left[\sum_{j = k + 1}^{n}\nabla_{k}u(r_{kj})\right]
\end{align}
We can now write the second term as \ref{second term in first derivative}):
\begin{align}\label{combined sum}
\prod_{i}\phi(\bold{r}_{i})
  \exp{\left(\sum_{i<j}u(r_{ij})\right)}
  \left[\sum_{j = k + 1}^{n}\nabla_{k}u(r_{kj}) +
  \left[\sum_{i = 1}^{k-1}\nabla_{k}u(r_{ik})\right]\right]
\end{align}
%CHECK THIS EQUATION
This can be rewritten to:
  \begin{align}
  \prod_{i}\phi(\bold{r}_{i})
    \exp{\left(\sum_{i<j}u(r_{ij})\right)}
    \left[\sum_{j \neq k}\nabla_{k}u(r_{kj})\right]
  \end{align}
  FORKLAR denne delen litt. Thus the first derivative of the trial wavefunction
  can be written as:
  \begin{align}
    \nabla_{k}\Psi_{T} =
    \nabla_k \phi(\mathbf{r}_k)\left[ \prod_{i\neq k} \phi(\mathbf{r}_i)\right]\exp\left(\sum_{i<j}u(r_{ij})\right)
    + \prod_{i}\phi(\bold{r}_{i})
      \exp{\left(\sum_{i<j}u(r_{ij})\right)}
      \left[\sum_{j \neq k}\nabla_{k}u(r_{kj})\right]
  \end{align}
\end{appendices}
Lastly we will calculate the second derivative of the trial function, where we
use the product rule and the chain rule. We will then obtain the following:
\begin{align*}
  \begin{split}
  \nabla_{k}^2\Psi_{T} =
  \underbrace{\nabla_k^2 \phi(\mathbf{r}_k)\left[ \prod_{i\neq k} \phi(\mathbf{r}_i)\right]\exp\left(\sum_{i<j}u(r_{ij})\right)}_{\mathrm{I}} +\\
   \underbrace{2\left(\nabla_k \phi(\mathbf{r}_k)\left[ \prod_{i\neq k} \phi(\mathbf{r}_i)\right]
  \exp{\left(\sum_{i<j}u(r_{ij})\right)}
  \left[\sum_{j \neq k}\nabla_{k}u(r_{kj})\right]\right)}_{\mathrm{II}} +
  \\
   \underbrace{\prod_{i}\phi(\bold{r}_{i})
    \exp{\left(\sum_{i<j}u(r_{ij})\right)}
    \left[\sum_{j \neq k}\nabla_{k}u(r_{kj})\right]^2}_{\mathrm{III}} +
    \\
    \underbrace{\prod_{i}\phi(\bold{r}_{i})
      \exp{\left(\sum_{i<j}u(r_{ij})\right)}
      \left[\sum_{j \neq k}\nabla_{k}\nabla_{k}u(r_{kj})\right]}_{\mathrm{IV}}
  \end{split}
\end{align*}
Where the derivatives of the different parts are obtained from previous.
We will now divide the second derivative by the trial wavefunction, and obtain:
\begin{align}
\frac{1}{\Psi_{T}}\nabla_{k}^2\Psi_{T} =
\underbrace{\frac{\nabla_{k}^2\phi{(\bold{r}_{k})}}{\phi(\bold{r}_{\phi(\bold{r}_{k})})}}_{\mathrm{I}}
+ \underbrace{2\frac{\nabla_{k}\phi(\bold{r}_{k})}{\phi{(\bold{r}_{k})}}\sum_{j\neq k}\nabla_{k}u(r_{kj})}_{\mathrm{II}}
+ \underbrace{\left(\sum_{j\neq k}\nabla_{k} u(r_{kj})\right)^2}_{\mathrm{III}} +
\underbrace{\left[\sum_{j \neq k}\nabla_{k}\nabla_{k}u(r_{kj})\right]}_{\mathrm{IV}}
\end{align}
We will now carry out the differentiation in term (II), (III) and (IV). Begining with the
(II), by using the chain rule we can rewrite (II) as:
\begin{align*}
2\frac{\nabla_{k}\phi(\bold{r}_{k})}{\phi{(\bold{r}_{k})}}\sum_{j\neq k}\pdv{u(r_{kj})}{r_{kj}}\pdv{r_{kj}}{\bold{r}_{k}} =
2\frac{\nabla_{k}\phi(\bold{r}_{k})}{\phi{(\bold{r}_{k})}}\left(\sum_{j\neq k}\frac{\bold{r}_{k} - \bold{r}_{j}}{r_{kj}}u'(r_{kj})\right)
\end{align*}
Where we have used $\nabla_{k} r_{kj} = (\bold{r}_{k} - \bold{r}_{j})/r_{kj}$.
Looking at (III), we can write out the square into two factors. The second paranthese the summation index is replaced by a
dummy index $i$. Thus will look as:
\begin{align}
  \left(\sum_{j\neq k}\nabla_{k} u(r_{kj})\right)^2 = \left(\sum_{j\neq k}\nabla_{k} u(r_{kj})\right)\left(\sum_{i\neq k}\nabla_{k} u(r_{ki})\right)
\end{align}
From (II) we found the derivative of this function. Thus this can be expressed as (combining also the double sum):
\begin{align}
  \left(\sum_{j\neq k}\nabla_{k} u(r_{kj})\right)^2 =
  \sum_{i, j\neq k}\left(\frac{\bold{r}_{k} - \bold{r}_{j}}{r_{kj}}\right)
  \left(\frac{\bold{r}_{k} - \bold{r}_{i}}{r_{ki}}\right)u'(r_{kj})u'(r_{ki})
\end{align}
The last part (IV), we must use the chain rule and product rule together. We will obtain
the following term:
\begin{align}
  \sum_{j \neq k}\nabla_{k}\nabla_{k}u(r_{kj}) =
  \sum_{j \neq k}\nabla_{k}\left(
  \left(\frac{\bold{r}_{k} - \bold{r}_{j}}{r_{kj}}\right)^2 u''(r_{kj}) + u'(r_{kj})\nabla_{k}
  \left(\frac{\bold{r}_{k} - \bold{r}_{j}}{r_{kj}}\right)\right)
\end{align}
Note that this is a unit vector squared:
\begin{align}
  \left(\frac{\bold{r}_{k} - \bold{r}_{j}}{r_{kj}}\right)^2 = 1
\end{align}
and the last part is found by using the qoutient rule. This is the divergence to the vectors, since we are evaluating for
specific particle k, and gradient to scalar (we must look for all combination of k particle):
\begin{align}
  \nabla_{k}
  \left(\frac{\bold{r}_{k} - \bold{r}_{j}}{r_{kj}}\right)
  = \frac{r_{kj}\left(\nabla_{k}\cdot\bold{r}_{k}-
  \nabla_{k}\cdot\bold{r}_{j}\right) -
  (\bold{r}_{k}-\bold{r}_{j})\nabla_{k}r_{kj}}{r_{kj}^2}
\end{align}
This simply becomes:
\begin{align}
  \nabla_{k}
  \left(\frac{\bold{r}_{k} - \bold{r}_{j}}{r_{kj}}\right)
  = \frac{3r_{kj}^2 - \bold{r}^2_{k} + 2(\bold{r}_{k}\cdot \bold{r}_{j}) - \bold{r}^2_{j}}{r_{kj}^3}
\end{align}
Note that $r_{kj} - \bold{r}^2_{k} + 2(\bold{r}_{k}\cdot \bold{r}_{j}) - \bold{r}^2_{j} = 0$, this leaves us with:
\begin{align}
  \nabla_{k}
  \left(\frac{\bold{r}_{k} - \bold{r}_{j}}{r_{kj}}\right)
  = \frac{2}{r_{kj}}
\end{align}
Thus expression (IV) can be expressed as:
\begin{align}
  \sum_{j \neq k}\nabla_{k}\nabla_{k}u(r_{kj}) =
  \sum_{j \neq k}\nabla_{k}\left(u''(r_{kj}) + \frac{2}{r_{kj}}u'(r_{kj})
\right)
\end{align}
Combining (I), (II), (III) and (IV), we we will get that the second derivative
of the trial function is:
\begin{align}
  \begin{split}
  \frac{1}{\Psi_{t}}\nabla_{k}^2\Psi_{T} =
  \frac{\nabla_{k}^2\phi{(\bold{r}_{k})}}{\phi(\bold{r}_{\phi(\bold{r}_{k})})}
  +
  2\frac{\nabla_{k}\phi(\bold{r}_{k})}{\phi{(\bold{r}_{k})}}\left(\sum_{j\neq k}\frac{\bold{r}_{k} - \bold{r}_{j}}{r_{kj}}u'(r_{kj})\right)
  +\\
  \sum_{i, j\neq k}\left(\frac{\bold{r}_{k} - \bold{r}_{j}}{r_{kj}}\right)
  \left(\frac{\bold{r}_{k} - \bold{r}_{i}}{r_{ki}}\right)u'(r_{kj})u'(r_{ki})
  +
  \sum_{j \neq k}\nabla_{k}\left(u''(r_{kj}) + \frac{2}{r_{kj}}u'(r_{kj})\right)
\end{split}
\end{align}
\end{document}
